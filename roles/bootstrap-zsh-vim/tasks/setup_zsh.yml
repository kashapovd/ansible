---
- name: remove old oh-my-zsh installation
  file:
    path: '{{ansible_env.HOME}}/.oh-my-zsh/'
    state: absent
  when: not update_only

- name: install oh-my-zsh
  shell: 'sh -c "$(wget -O- https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended --keep-zshrc'
  when: not update_only

- name: change default shell
  shell: '[[ ! $SHELL = "/bin/zsh" ]] && chsh -s "/bin/zsh" || true'
  async: 1
  poll: 0
  when: not update_only